<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#6366f1">
<title>Ø­Ø³Ø§Ø¨Ø¯Ø§Ø±ÛŒ Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ Ø®Ø§Ø¯Ù…ÛŒ</title>
<link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: 'Vazirmatn', sans-serif;
    -webkit-tap-highlight-color: transparent;
}

:root {
    --primary: #6366f1;
    --primary-dark: #4f46e5;
    --secondary: #8b5cf6;
    --success: #10b981;
    --danger: #ef4444;
    --warning: #f59e0b;
    --info: #3b82f6;
    --dark: #1f2937;
    --light: #f9fafb;
    --gray: #6b7280;
    --border: #e5e7eb;
    --shadow: rgba(0, 0, 0, 0.1);
    --bg-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

body {
    background: var(--light);
    color: var(--dark);
    overflow-x: hidden;
    padding-bottom: 80px;
}

/* Header */
.header {
    background: var(--bg-gradient);
    color: white;
    padding: 15px 20px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    box-shadow: 0 4px 12px var(--shadow);
    position: sticky;
    top: 0;
    z-index: 1000;
}

.header-title {
    font-size: 18px;
    font-weight: 800;
    display: flex;
    align-items: center;
    gap: 10px;
}

.header-logo {
    width: 35px;
    height: 35px;
    background: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
}

.header-actions {
    display: flex;
    gap: 10px;
}

.header-btn {
    width: 35px;
    height: 35px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.2);
    border: none;
    color: white;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
    transition: all 0.3s;
}

.header-btn:active {
    transform: scale(0.9);
    background: rgba(255, 255, 255, 0.3);
}

/* Bottom Navigation */
.bottom-nav {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: white;
    display: flex;
    justify-content: space-around;
    padding: 10px 0 5px 0;
    box-shadow: 0 -2px 10px var(--shadow);
    z-index: 1000;
    border-top: 1px solid var(--border);
}

.nav-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 3px;
    cursor: pointer;
    padding: 5px 12px;
    transition: all 0.3s;
    color: var(--gray);
    text-decoration: none;
    flex: 1;
    border-radius: 12px;
}

.nav-item.active {
    color: var(--primary);
    background: rgba(99, 102, 241, 0.05);
}

.nav-icon {
    font-size: 22px;
    transition: transform 0.3s;
}

.nav-item.active .nav-icon {
    transform: scale(1.15);
}

.nav-label {
    font-size: 10px;
    font-weight: 600;
}

/* Page Container */
.page {
    display: none;
    padding: 20px;
    animation: fadeIn 0.3s;
    min-height: calc(100vh - 150px);
}

.page.active {
    display: block;
}

@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Cards */
.card {
    background: white;
    border-radius: 16px;
    padding: 20px;
    margin-bottom: 20px;
    box-shadow: 0 2px 8px var(--shadow);
}

.card-header {
    font-size: 17px;
    font-weight: 700;
    margin-bottom: 15px;
    color: var(--dark);
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.card-header-left {
    display: flex;
    align-items: center;
    gap: 10px;
}

.card-icon {
    width: 35px;
    height: 35px;
    background: var(--bg-gradient);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 16px;
    flex-shrink: 0;
}

/* Currency Cards */
.currency-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 15px;
}

.currency-card {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 16px;
    padding: 18px;
    color: white;
    box-shadow: 0 4px 12px rgba(102, 102, 255, 0.3);
    position: relative;
    overflow: hidden;
    cursor: pointer;
    transition: all 0.3s;
}

.currency-card:active {
    transform: scale(0.98);
}

.currency-card::before {
    content: '';
    position: absolute;
    top: -50%;
    right: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
}

.currency-name {
    font-size: 13px;
    opacity: 0.9;
    margin-bottom: 8px;
}

.currency-amount {
    font-size: 22px;
    font-weight: 800;
    margin-bottom: 5px;
    direction: ltr;
    text-align: right;
}

.currency-flag {
    position: absolute;
    top: 12px;
    left: 12px;
    font-size: 22px;
}

.currency-country {
    font-size: 11px;
    opacity: 0.8;
}

.currency-AFN {
    background: linear-gradient(135deg, #D32F2F 0%, #C62828 100%);
}

.currency-TRY {
    background: linear-gradient(135deg, #E53935 0%, #B71C1C 100%);
}

.currency-USD {
    background: linear-gradient(135deg, #1976D2 0%, #1565C0 100%);
}

.currency-AED {
    background: linear-gradient(135deg, #00796B 0%, #00695C 100%);
}

/* Stats Grid */
.stats-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 12px;
}

.stat-card {
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    border-radius: 12px;
    padding: 15px;
    text-align: center;
    border: 2px solid var(--border);
}

.stat-value {
    font-size: 22px;
    font-weight: 800;
    margin-bottom: 5px;
    direction: ltr;
}

.stat-value.income {
    color: var(--success);
}

.stat-value.expense {
    color: var(--danger);
}

.stat-label {
    font-size: 12px;
    color: var(--gray);
    font-weight: 600;
}

/* Forms */
.form-group {
    margin-bottom: 15px;
}

.form-label {
    display: block;
    font-size: 13px;
    font-weight: 700;
    margin-bottom: 8px;
    color: var(--dark);
}

.form-input,
.form-select,
.form-textarea {
    width: 100%;
    padding: 12px 15px;
    border: 2px solid var(--border);
    border-radius: 12px;
    font-size: 15px;
    transition: all 0.3s;
    background: white;
    color: var(--dark);
}

.form-textarea {
    min-height: 80px;
    resize: vertical;
}

.form-input:focus,
.form-select:focus,
.form-textarea:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
}

/* Buttons */
.btn {
    padding: 12px 20px;
    border-radius: 12px;
    border: none;
    font-size: 14px;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.3s;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
}

.btn:active {
    transform: scale(0.98);
}

.btn-primary {
    background: var(--bg-gradient);
    color: white;
    box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
}

.btn-success {
    background: var(--success);
    color: white;
    box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
}

.btn-danger {
    background: var(--danger);
    color: white;
    box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
}

.btn-warning {
    background: var(--warning);
    color: white;
    box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
}

.btn-outline {
    background: white;
    color: var(--primary);
    border: 2px solid var(--primary);
}

.btn-block {
    width: 100%;
}

.btn-sm {
    padding: 8px 16px;
    font-size: 12px;
}

/* Transaction List */
.transaction-list {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.transaction-item {
    background: white;
    border-radius: 12px;
    padding: 15px;
    display: flex;
    align-items: center;
    gap: 12px;
    box-shadow: 0 2px 6px var(--shadow);
    cursor: pointer;
    transition: all 0.3s;
    border: 2px solid transparent;
}

.transaction-item:active {
    transform: scale(0.98);
    border-color: var(--primary);
}

.transaction-icon {
    width: 45px;
    height: 45px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    flex-shrink: 0;
}

.transaction-icon.income {
    background: rgba(16, 185, 129, 0.1);
    color: var(--success);
}

.transaction-icon.expense {
    background: rgba(239, 68, 68, 0.1);
    color: var(--danger);
}

.transaction-icon.transfer {
    background: rgba(59, 130, 246, 0.1);
    color: var(--info);
}

.transaction-info {
    flex: 1;
    min-width: 0;
}

.transaction-title {
    font-size: 14px;
    font-weight: 700;
    margin-bottom: 4px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.transaction-desc {
    font-size: 12px;
    color: var(--gray);
    display: flex;
    align-items: center;
    gap: 8px;
}

.transaction-amount {
    font-size: 15px;
    font-weight: 800;
    direction: ltr;
    flex-shrink: 0;
}

.transaction-amount.income {
    color: var(--success);
}

.transaction-amount.expense {
    color: var(--danger);
}

.transaction-amount.transfer {
    color: var(--info);
}

/* Country Selector */
.country-selector {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 10px;
    margin-bottom: 20px;
}

.country-btn {
    padding: 12px 8px;
    border: 2px solid var(--border);
    border-radius: 12px;
    background: white;
    cursor: pointer;
    transition: all 0.3s;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 6px;
}

.country-btn.active {
    border-color: var(--primary);
    background: rgba(99, 102, 241, 0.05);
    box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
}

.country-btn:active {
    transform: scale(0.95);
}

.country-flag {
    font-size: 28px;
}

.country-name {
    font-size: 12px;
    font-weight: 700;
}

/* Exchange Calculator */
.exchange-box {
    background: white;
    border-radius: 16px;
    padding: 18px;
    margin-bottom: 15px;
    box-shadow: 0 2px 8px var(--shadow);
    border: 2px solid var(--border);
}

.exchange-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 15px;
}

.exchange-icon {
    width: 40px;
    height: 40px;
    border-radius: 12px;
    background: var(--bg-gradient);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 18px;
}

.rate-badge {
    background: rgba(99, 102, 241, 0.1);
    color: var(--primary);
    padding: 6px 12px;
    border-radius: 8px;
    font-size: 12px;
    font-weight: 700;
}

/* Filter Tabs */
.filter-tabs {
    display: flex;
    gap: 8px;
    margin-bottom: 20px;
    overflow-x: auto;
    padding-bottom: 5px;
}

.filter-tabs::-webkit-scrollbar {
    height: 4px;
}

.filter-tabs::-webkit-scrollbar-thumb {
    background: var(--border);
    border-radius: 4px;
}

.filter-tab {
    padding: 8px 16px;
    border-radius: 20px;
    border: 2px solid var(--border);
    background: white;
    cursor: pointer;
    white-space: nowrap;
    font-size: 13px;
    font-weight: 700;
    transition: all 0.3s;
    flex-shrink: 0;
}

.filter-tab.active {
    background: var(--primary);
    color: white;
    border-color: var(--primary);
    box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
}

.filter-tab:active {
    transform: scale(0.95);
}

/* Modal */
.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.6);
    z-index: 2000;
    padding: 20px;
    overflow-y: auto;
    backdrop-filter: blur(5px);
}

.modal.active {
    display: flex;
    align-items: center;
    justify-content: center;
    animation: fadeIn 0.3s;
}

.modal-content {
    background: white;
    border-radius: 20px;
    padding: 25px;
    max-width: 500px;
    width: 100%;
    max-height: 85vh;
    overflow-y: auto;
    animation: slideUp 0.3s;
}

@keyframes slideUp {
    from {
        opacity: 0;
        transform: translateY(50px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.modal-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 20px;
    padding-bottom: 15px;
    border-bottom: 2px solid var(--border);
}

.modal-title {
    font-size: 18px;
    font-weight: 800;
    display: flex;
    align-items: center;
    gap: 10px;
}

.modal-close {
    width: 35px;
    height: 35px;
    border-radius: 50%;
    border: none;
    background: var(--light);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    transition: all 0.3s;
    color: var(--gray);
}

.modal-close:active {
    transform: scale(0.9);
    background: var(--border);
}

/* Reports */
.report-section {
    margin-bottom: 25px;
}

.report-title {
    font-size: 16px;
    font-weight: 800;
    margin-bottom: 12px;
    display: flex;
    align-items: center;
    gap: 8px;
    color: var(--dark);
}

.report-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
}

.report-item {
    background: white;
    border-radius: 12px;
    padding: 15px;
    box-shadow: 0 2px 6px var(--shadow);
    border: 2px solid var(--border);
}

.report-label {
    font-size: 12px;
    color: var(--gray);
    margin-bottom: 8px;
    font-weight: 600;
}

.report-value {
    font-size: 18px;
    font-weight: 800;
    color: var(--primary);
    direction: ltr;
    text-align: right;
}

/* Empty State */
.empty-state {
    text-align: center;
    padding: 40px 20px;
}

.empty-icon {
    font-size: 60px;
    margin-bottom: 15px;
    opacity: 0.3;
}

.empty-text {
    font-size: 15px;
    color: var(--gray);
    font-weight: 600;
}

/* Toast Notification */
.toast {
    position: fixed;
    bottom: 100px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(0, 0, 0, 0.9);
    color: white;
    padding: 12px 24px;
    border-radius: 25px;
    font-size: 14px;
    font-weight: 700;
    z-index: 3000;
    animation: slideUp 0.3s;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
    max-width: 90%;
    text-align: center;
}

.toast.success {
    background: var(--success);
}

.toast.error {
    background: var(--danger);
}

/* Action Buttons */
.action-buttons {
    display: flex;
    gap: 10px;
    margin-top: 15px;
}

/* Delete Button in Transaction */
.delete-btn {
    width: 35px;
    height: 35px;
    border-radius: 50%;
    background: rgba(239, 68, 68, 0.1);
    color: var(--danger);
    border: none;
    font-size: 16px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s;
}

.delete-btn:active {
    transform: scale(0.9);
    background: rgba(239, 68, 68, 0.2);
}

/* Loading Spinner */
.spinner {
    border: 3px solid var(--border);
    border-top: 3px solid var(--primary);
    border-radius: 50%;
    width: 40px;
    height: 40px;
    animation: spin 1s linear infinite;
    margin: 20px auto;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* Responsive */
@media (min-width: 768px) {
    body {
        max-width: 480px;
        margin: 0 auto;
        box-shadow: 0 0 30px var(--shadow);
    }
    
    .header,
    .bottom-nav {
        max-width: 480px;
        left: 50%;
        transform: translateX(-50%);
    }
}

/* Search Input */
.search-box {
    margin-bottom: 15px;
}

.search-input {
    width: 100%;
    padding: 12px 15px 12px 45px;
    border: 2px solid var(--border);
    border-radius: 25px;
    font-size: 14px;
    background: white url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="%236b7280" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>') no-repeat 15px center;
    transition: all 0.3s;
}

.search-input:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
}

/* Settings Page Styles */
.settings-group {
    margin-bottom: 25px;
}

.settings-title {
    font-size: 14px;
    font-weight: 800;
    color: var(--gray);
    margin-bottom: 12px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.settings-item {
    background: white;
    border-radius: 12px;
    padding: 15px;
    margin-bottom: 8px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    cursor: pointer;
    transition: all 0.3s;
    border: 2px solid var(--border);
}

.settings-item:active {
    transform: scale(0.98);
    border-color: var(--primary);
}

.settings-item-left {
    display: flex;
    align-items: center;
    gap: 12px;
}

.settings-icon {
    width: 40px;
    height: 40px;
    border-radius: 10px;
    background: var(--light);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
}

.settings-info h4 {
    font-size: 14px;
    font-weight: 700;
    margin-bottom: 3px;
}

.settings-info p {
    font-size: 12px;
    color: var(--gray);
}

.settings-arrow {
    color: var(--gray);
    font-size: 18px;
}

/* Badge */
.badge {
    display: inline-block;
    padding: 4px 10px;
    border-radius: 12px;
    font-size: 11px;
    font-weight: 700;
    background: var(--primary);
    color: white;
}

.badge.success {
    background: var(--success);
}

.badge.danger {
    background: var(--danger);
}

.badge.warning {
    background: var(--warning);
}
</style>
</head>
<body>

<!-- Header -->
<div class="header">
    <div class="header-title">
        <div class="header-logo">ğŸ’°</div>
        <span>Ø­Ø³Ø§Ø¨Ø¯Ø§Ø±ÛŒ Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ Ø®Ø§Ø¯Ù…ÛŒ</span>
    </div>
    <div class="header-actions">
        <button class="header-btn" onclick="showSettings()" title="ØªÙ†Ø¸ÛŒÙ…Ø§Øª">âš™ï¸</button>
    </div>
</div>

<!-- Dashboard Page -->
<div class="page active" id="dashboardPage">
    <!-- Currency Cards -->
    <div class="currency-grid">
        <div class="currency-card currency-AFN" onclick="showCurrencyDetails('AFN')">
            <div class="currency-flag">ğŸ‡¦ğŸ‡«</div>
            <div class="currency-name">Ø§ÙØºØ§Ù†ÛŒ</div>
            <div class="currency-amount" id="balanceAFN">0</div>
            <div class="currency-country">Ø§ÙØºØ§Ù†Ø³ØªØ§Ù†</div>
        </div>
        <div class="currency-card currency-TRY" onclick="showCurrencyDetails('TRY')">
            <div class="currency-flag">ğŸ‡¹ğŸ‡·</div>
            <div class="currency-name">Ù„ÛŒØ±Ù‡</div>
            <div class="currency-amount" id="balanceTRY">0</div>
            <div class="currency-country">ØªØ±Ú©ÛŒÙ‡</div>
        </div>
        <div class="currency-card currency-USD" onclick="showCurrencyDetails('USD')">
            <div class="currency-flag">ğŸ‡ºğŸ‡¸</div>
            <div class="currency-name">Ø¯Ø§Ù„Ø±</div>
            <div class="currency-amount" id="balanceUSD">0</div>
            <div class="currency-country">Ø¢Ù…Ø±ÛŒÚ©Ø§</div>
        </div>
        <div class="currency-card currency-AED" onclick="showCurrencyDetails('AED')">
            <div class="currency-flag">ğŸ‡¦ğŸ‡ª</div>
            <div class="currency-name">Ø¯Ø±Ù‡Ù…</div>
            <div class="currency-amount" id="balanceAED">0</div>
            <div class="currency-country">Ø¯Ø¨ÛŒ</div>
        </div>
    </div>

    <!-- Quick Stats -->
    <div class="card">
        <div class="card-header">
            <div class="card-header-left">
                <div class="card-icon">ğŸ“Š</div>
                <span>Ø¢Ù…Ø§Ø± Ø³Ø±ÛŒØ¹</span>
            </div>
            <span class="badge" id="transactionCount">0 ØªØ±Ø§Ú©Ù†Ø´</span>
        </div>
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value income" id="totalIncome">0</div>
                <div class="stat-label">ğŸ’š Ú©Ù„ Ø¯Ø±Ø¢Ù…Ø¯</div>
            </div>
            <div class="stat-card">
                <div class="stat-value expense" id="totalExpense">0</div>
                <div class="stat-label">â¤ï¸ Ú©Ù„ Ù‡Ø²ÛŒÙ†Ù‡</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="totalTransfers" style="color: var(--info);">0</div>
                <div class="stat-label">ğŸ”„ Ø§Ù†ØªÙ‚Ø§Ù„Ø§Øª</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="netBalance" style="color: var(--warning);">0</div>
                <div class="stat-label">ğŸ’° Ø®Ø§Ù„Øµ</div>
            </div>
        </div>
    </div>

    <!-- Recent Transactions -->
    <div class="card">
        <div class="card-header">
            <div class="card-header-left">
                <div class="card-icon">ğŸ“</div>
                <span>ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§ÛŒ Ø§Ø®ÛŒØ±</span>
            </div>
            <a href="#" onclick="showPage('transactions')" style="color: var(--primary); font-size: 12px; text-decoration: none; font-weight: 700;">Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ù‡Ù…Ù‡ â†</a>
        </div>
        <div class="transaction-list" id="recentTransactions">
            <div class="empty-state">
                <div class="empty-icon">ğŸ“­</div>
                <div class="empty-text">Ù‡Ù†ÙˆØ² ØªØ±Ø§Ú©Ù†Ø´ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª</div>
            </div>
        </div>
    </div>
</div>

<!-- Transactions Page -->
<div class="page" id="transactionsPage">
    <!-- Search Box -->
    <div class="search-box">
        <input type="text" class="search-input" id="searchInput" placeholder="Ø¬Ø³ØªØ¬Ùˆ Ø¯Ø± ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§..." oninput="searchTransactions()">
    </div>

    <!-- Filter Tabs -->
    <div class="filter-tabs">
        <button class="filter-tab active" onclick="filterTransactions('all')">Ù‡Ù…Ù‡</button>
        <button class="filter-tab" onclick="filterTransactions('income')">ğŸ’š Ø¯Ø±Ø¢Ù…Ø¯</button>
        <button class="filter-tab" onclick="filterTransactions('expense')">â¤ï¸ Ù‡Ø²ÛŒÙ†Ù‡</button>
        <button class="filter-tab" onclick="filterTransactions('transfer')">ğŸ”„ Ø§Ù†ØªÙ‚Ø§Ù„</button>
        <button class="filter-tab" onclick="filterTransactions('AFN')">ğŸ‡¦ğŸ‡« Ø§ÙØºØ§Ù†ÛŒ</button>
        <button class="filter-tab" onclick="filterTransactions('TRY')">ğŸ‡¹ğŸ‡· Ù„ÛŒØ±Ù‡</button>
        <button class="filter-tab" onclick="filterTransactions('USD')">ğŸ‡ºğŸ‡¸ Ø¯Ø§Ù„Ø±</button>
        <button class="filter-tab" onclick="filterTransactions('AED')">ğŸ‡¦ğŸ‡ª Ø¯Ø±Ù‡Ù…</button>
    </div>

    <!-- Transaction List -->
    <div class="transaction-list" id="allTransactions">
        <div class="empty-state">
            <div class="empty-icon">ğŸ“‹</div>
            <div class="empty-text">ØªØ±Ø§Ú©Ù†Ø´ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯</div>
        </div>
    </div>
</div>

<!-- Add Transaction Page -->
<div class="page" id="addPage">
    <div class="card">
        <div class="card-header">
            <div class="card-header-left">
                <div class="card-icon">â•</div>
                <span>Ø§ÙØ²ÙˆØ¯Ù† ØªØ±Ø§Ú©Ù†Ø´ Ø¬Ø¯ÛŒØ¯</span>
            </div>
        </div>

        <div class="country-selector">
            <button class="country-btn active" data-country="AFG" onclick="selectCountry('AFG')">
                <div class="country-flag">ğŸ‡¦ğŸ‡«</div>
                <div class="country-name">Ø§ÙØºØ§Ù†Ø³ØªØ§Ù†</div>
            </button>
            <button class="country-btn" data-country="TUR" onclick="selectCountry('TUR')">
                <div class="country-flag">ğŸ‡¹ğŸ‡·</div>
                <div class="country-name">ØªØ±Ú©ÛŒÙ‡</div>
            </button>
            <button class="country-btn" data-country="UAE" onclick="selectCountry('UAE')">
                <div class="country-flag">ğŸ‡¦ğŸ‡ª</div>
                <div class="country-name">Ø¯Ø¨ÛŒ</div>
            </button>
        </div>

        <form id="transactionForm" onsubmit="addTransaction(event)">
            <div class="form-group">
                <label class="form-label">Ù†ÙˆØ¹ ØªØ±Ø§Ú©Ù†Ø´</label>
                <select class="form-select" id="transactionType" required onchange="handleTypeChange()">
                    <option value="income">ğŸ’š Ø¯Ø±Ø¢Ù…Ø¯</option>
                    <option value="expense">â¤ï¸ Ù‡Ø²ÛŒÙ†Ù‡</option>
                    <option value="transfer">ğŸ”„ Ø§Ù†ØªÙ‚Ø§Ù„ ÙˆØ¬Ù‡</option>
                </select>
            </div>

            <div class="form-group">
                <label class="form-label">Ø§Ø±Ø² Ù…Ø¨Ø¯Ø§</label>
                <select class="form-select" id="currency" required>
                    <option value="AFN">ğŸ‡¦ğŸ‡« Ø§ÙØºØ§Ù†ÛŒ</option>
                    <option value="TRY">ğŸ‡¹ğŸ‡· Ù„ÛŒØ±Ù‡</option>
                    <option value="USD">ğŸ‡ºğŸ‡¸ Ø¯Ø§Ù„Ø±</option>
                    <option value="AED">ğŸ‡¦ğŸ‡ª Ø¯Ø±Ù‡Ù…</option>
                </select>
            </div>

            <div class="form-group">
                <label class="form-label">Ù…Ø¨Ù„Øº</label>
                <input type="number" class="form-input" id="amount" placeholder="Ù…Ø¨Ù„Øº Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯" required step="0.01" min="0.01">
            </div>

            <div class="form-group" id="transferCurrencyGroup" style="display: none;">
                <label class="form-label">Ø¨Ù‡ Ø§Ø±Ø²</label>
                <select class="form-select" id="toCurrency">
                    <option value="AFN">ğŸ‡¦ğŸ‡« Ø§ÙØºØ§Ù†ÛŒ</option>
                    <option value="TRY">ğŸ‡¹ğŸ‡· Ù„ÛŒØ±Ù‡</option>
                    <option value="USD">ğŸ‡ºğŸ‡¸ Ø¯Ø§Ù„Ø±</option>
                    <option value="AED">ğŸ‡¦ğŸ‡ª Ø¯Ø±Ù‡Ù…</option>
                </select>
            </div>

            <div class="form-group">
                <label class="form-label">Ø´Ø±Ø­</label>
                <input type="text" class="form-input" id="description" placeholder="ØªÙˆØ¶ÛŒØ­Ø§Øª ØªØ±Ø§Ú©Ù†Ø´" required>
            </div>

            <div class="form-group">
                <label class="form-label">ÛŒØ§Ø¯Ø¯Ø§Ø´Øª (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)</label>
                <textarea class="form-textarea" id="notes" placeholder="ÛŒØ§Ø¯Ø¯Ø§Ø´Øªâ€ŒÙ‡Ø§ÛŒ Ø§Ø¶Ø§ÙÛŒ..."></textarea>
            </div>

            <button type="submit" class="btn btn-primary btn-block">
                âœ… Ø«Ø¨Øª ØªØ±Ø§Ú©Ù†Ø´
            </button>
        </form>
    </div>
</div>

<!-- Exchange Page -->
<div class="page" id="exchangePage">
    <div class="card">
        <div class="card-header">
            <div class="card-header-left">
                <div class="card-icon">ğŸ’±</div>
                <span>Ù…Ø­Ø§Ø³Ø¨Ù‡â€ŒÚ¯Ø± ØªØ¨Ø¯ÛŒÙ„ Ø§Ø±Ø²</span>
            </div>
        </div>

        <div class="exchange-box">
            <div class="exchange-header">
                <div class="exchange-icon">ğŸ“¤</div>
                <div class="rate-badge">Ø§Ø²</div>
            </div>
            <div class="form-group">
                <select class="form-select" id="fromCurrency" onchange="calculateExchange()">
                    <option value="AFN">ğŸ‡¦ğŸ‡« Ø§ÙØºØ§Ù†ÛŒ</option>
                    <option value="TRY">ğŸ‡¹ğŸ‡· Ù„ÛŒØ±Ù‡</option>
                    <option value="USD" selected>ğŸ‡ºğŸ‡¸ Ø¯Ø§Ù„Ø±</option>
                    <option value="AED">ğŸ‡¦ğŸ‡ª Ø¯Ø±Ù‡Ù…</option>
                </select>
            </div>
            <div class="form-group">
                <input type="number" class="form-input" id="fromAmount" placeholder="Ù…Ø¨Ù„Øº" step="0.01" oninput="calculateExchange()" style="font-size: 20px; font-weight: 700; text-align: center;">
            </div>
        </div>

        <div style="text-align: center; margin: -10px 0; font-size: 28px;">â¬‡ï¸</div>

        <div class="exchange-box">
            <div class="exchange-header">
                <div class="exchange-icon">ğŸ“¥</div>
                <div class="rate-badge" id="exchangeRate">Ù†Ø±Ø®: -</div>
            </div>
            <div class="form-group">
                <select class="form-select" id="toCurrencyExchange" onchange="calculateExchange()">
                    <option value="AFN" selected>ğŸ‡¦ğŸ‡« Ø§ÙØºØ§Ù†ÛŒ</option>
                    <option value="TRY">ğŸ‡¹ğŸ‡· Ù„ÛŒØ±Ù‡</option>
                    <option value="USD">ğŸ‡ºğŸ‡¸ Ø¯Ø§Ù„Ø±</option>
                    <option value="AED">ğŸ‡¦ğŸ‡ª Ø¯Ø±Ù‡Ù…</option>
                </select>
            </div>
            <div class="form-group">
                <input type="number" class="form-input" id="toAmount" placeholder="Ø¯Ø±ÛŒØ§ÙØªÛŒ" readonly style="font-size: 20px; font-weight: 700; text-align: center; background: var(--light);">
            </div>
        </div>

        <button class="btn btn-success btn-block" onclick="executeExchange()">
            ğŸ’± ØªØ¨Ø¯ÛŒÙ„ Ùˆ Ø«Ø¨Øª
        </button>
    </div>

    <!-- Exchange Rates Table -->
    <div class="card">
        <div class="card-header">
            <div class="card-header-left">
                <div class="card-icon">ğŸ“ˆ</div>
                <span>Ù†Ø±Ø®â€ŒÙ‡Ø§ÛŒ Ø§Ø±Ø²</span>
            </div>
        </div>
        <div class="report-grid">
            <div class="report-item">
                <div class="report-label">USD â†’ AFN</div>
                <div class="report-value" id="rateUSD_AFN">70.00</div>
            </div>
            <div class="report-item">
                <div class="report-label">USD â†’ TRY</div>
                <div class="report-value" id="rateUSD_TRY">32.00</div>
            </div>
            <div class="report-item">
                <div class="report-label">USD â†’ AED</div>
                <div class="report-value" id="rateUSD_AED">3.67</div>
            </div>
            <div class="report-item">
                <div class="report-label">EUR â†’ USD</div>
                <div class="report-value" id="rateEUR_USD">1.08</div>
            </div>
        </div>
    </div>
</div>

<!-- Reports Page -->
<div class="page" id="reportsPage">
    <div class="card">
        <div class="card-header">
            <div class="card-header-left">
                <div class="card-icon">ğŸ“Š</div>
                <span>Ú¯Ø²Ø§Ø±Ø´ Ù…Ø§Ù„ÛŒ Ú©Ø§Ù…Ù„</span>
            </div>
        </div>

        <div class="report-section">
            <div class="report-title">ğŸ’° Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø¨Ù‡ ØªÙÚ©ÛŒÚ© Ø§Ø±Ø²</div>
            <div class="report-grid">
                <div class="report-item">
                    <div class="report-label">ğŸ‡¦ğŸ‡« Ø§ÙØºØ§Ù†ÛŒ</div>
                    <div class="report-value" id="reportAFN">0</div>
                </div>
                <div class="report-item">
                    <div class="report-label">ğŸ‡¹ğŸ‡· Ù„ÛŒØ±Ù‡</div>
                    <div class="report-value" id="reportTRY">0</div>
                </div>
                <div class="report-item">
                    <div class="report-label">ğŸ‡ºğŸ‡¸ Ø¯Ø§Ù„Ø±</div>
                    <div class="report-value" id="reportUSD">0</div>
                </div>
                <div class="report-item">
                    <div class="report-label">ğŸ‡¦ğŸ‡ª Ø¯Ø±Ù‡Ù…</div>
                    <div class="report-value" id="reportAED">0</div>
                </div>
            </div>
        </div>

        <div class="report-section">
            <div class="report-title">ğŸ“ˆ Ø®Ù„Ø§ØµÙ‡ Ù…Ø§Ù„ÛŒ</div>
            <div class="report-grid">
                <div class="report-item">
                    <div class="report-label">ğŸ’š Ú©Ù„ Ø¯Ø±Ø¢Ù…Ø¯</div>
                    <div class="report-value" id="reportTotalIncome" style="color: var(--success);">0</div>
                </div>
                <div class="report-item">
                    <div class="report-label">â¤ï¸ Ú©Ù„ Ù‡Ø²ÛŒÙ†Ù‡</div>
                    <div class="report-value" id="reportTotalExpense" style="color: var(--danger);">0</div>
                </div>
                <div class="report-item">
                    <div class="report-label">ğŸ”„ Ú©Ù„ Ø§Ù†ØªÙ‚Ø§Ù„Ø§Øª</div>
                    <div class="report-value" id="reportTotalTransfers" style="color: var(--info);">0</div>
                </div>
                <div class="report-item">
                    <div class="report-label">ğŸ’° Ø®Ø§Ù„Øµ (Ø¯Ø±Ø¢Ù…Ø¯ - Ù‡Ø²ÛŒÙ†Ù‡)</div>
                    <div class="report-value" id="reportNetBalance" style="color: var(--warning);">0</div>
                </div>
            </div>
        </div>

        <div class="report-section">
            <div class="report-title">ğŸŒ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø¨Ù‡ ØªÙÚ©ÛŒÚ© Ú©Ø´ÙˆØ±</div>
            <div class="report-grid">
                <div class="report-item">
                    <div class="report-label">ğŸ‡¦ğŸ‡« Ø§ÙØºØ§Ù†Ø³ØªØ§Ù†</div>
                    <div class="report-value" id="reportAfghanistan">0 AFN</div>
                </div>
                <div class="report-item">
                    <div class="report-label">ğŸ‡¹ğŸ‡· ØªØ±Ú©ÛŒÙ‡</div>
                    <div class="report-value" id="reportTurkey">0 TRY</div>
                </div>
                <div class="report-item">
                    <div class="report-label">ğŸ‡¦ğŸ‡ª Ø¯Ø¨ÛŒ</div>
                    <div class="report-value" id="reportDubai">0 AED</div>
                </div>
                <div class="report-item">
                    <div class="report-label">ğŸ“Š Ø§Ø±Ø²Ø´ Ú©Ù„ (USD)</div>
                    <div class="report-value" id="reportTotal">0</div>
                </div>
            </div>
        </div>

        <div class="action-buttons">
            <button class="btn btn-success btn-block" onclick="exportToJSON()">
                ğŸ“¥ Ø®Ø±ÙˆØ¬ÛŒ JSON
            </button>
        </div>
        <div class="action-buttons">
            <button class="btn btn-warning btn-block" onclick="importFromJSON()">
                ğŸ“¤ ÙˆØ±ÙˆØ¯ Ø§Ø² JSON
            </button>
        </div>
        <div class="action-buttons">
            <button class="btn btn-danger btn-block" onclick="resetAllData()">
                ğŸ—‘ï¸ Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù‡Ù…Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
            </button>
        </div>
    </div>
</div>

<!-- Settings Page -->
<div class="page" id="settingsPage">
    <div class="settings-group">
        <div class="settings-title">âš™ï¸ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¹Ù…ÙˆÙ…ÛŒ</div>
        
        <div class="settings-item" onclick="showAbout()">
            <div class="settings-item-left">
                <div class="settings-icon">â„¹ï¸</div>
                <div class="settings-info">
                    <h4>Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ø¨Ø±Ù†Ø§Ù…Ù‡</h4>
                    <p>Ù†Ø³Ø®Ù‡ 2.0 - Ø­Ø³Ø§Ø¨Ø¯Ø§Ø±ÛŒ Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ Ø®Ø§Ø¯Ù…ÛŒ</p>
                </div>
            </div>
            <div class="settings-arrow">â†</div>
        </div>

        <div class="settings-item" onclick="showHelp()">
            <div class="settings-item-left">
                <div class="settings-icon">â“</div>
                <div class="settings-info">
                    <h4>Ø±Ø§Ù‡Ù†Ù…Ø§</h4>
                    <p>Ù†Ø­ÙˆÙ‡ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø¨Ø±Ù†Ø§Ù…Ù‡</p>
                </div>
            </div>
            <div class="settings-arrow">â†</div>
        </div>
    </div>

    <div class="settings-group">
        <div class="settings-title">ğŸ“Š Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§</div>
        
        <div class="settings-item" onclick="showBackup()">
            <div class="settings-item-left">
                <div class="settings-icon">ğŸ’¾</div>
                <div class="settings-info">
                    <h4>Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ</h4>
                    <p>Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§</p>
                </div>
            </div>
            <div class="settings-arrow">â†</div>
        </div>

        <div class="settings-item" onclick="importFromJSON()">
            <div class="settings-item-left">
                <div class="settings-icon">ğŸ“¤</div>
                <div class="settings-info">
                    <h4>Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ</h4>
                    <p>Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§</p>
                </div>
            </div>
            <div class="settings-arrow">â†</div>
        </div>
    </div>

    <div class="card" style="margin-top: 20px;">
        <div class="card-header">
            <div class="card-header-left">
                <div class="card-icon">ğŸ“±</div>
                <span>Ù†ØµØ¨ Ø¨Ø±Ù†Ø§Ù…Ù‡</span>
            </div>
        </div>
        <p style="font-size: 13px; color: var(--gray); line-height: 1.8; margin-bottom: 15px;">
            Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø¨Ù‡ØªØ±ØŒ Ø§ÛŒÙ† Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø±Ø§ Ø±ÙˆÛŒ ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ Ù…ÙˆØ¨Ø§ÛŒÙ„ Ø®ÙˆØ¯ Ù†ØµØ¨ Ú©Ù†ÛŒØ¯. Ø§Ø² Ù…Ù†ÙˆÛŒ Ù…Ø±ÙˆØ±Ú¯Ø± Ú¯Ø²ÛŒÙ†Ù‡ "Add to Home Screen" Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.
        </p>
        <div style="background: var(--light); padding: 15px; border-radius: 12px; text-align: center;">
            <div style="font-size: 40px; margin-bottom: 10px;">ğŸ“²</div>
            <div style="font-size: 13px; font-weight: 700; color: var(--dark);">
                iOS: Safari Menu â†’ Add to Home Screen<br>
                Android: Chrome Menu â†’ Install App
            </div>
        </div>
    </div>
</div>

<!-- Bottom Navigation -->
<div class="bottom-nav">
    <a class="nav-item active" href="#" onclick="showPage('dashboard')">
        <div class="nav-icon">ğŸ </div>
        <div class="nav-label">Ø®Ø§Ù†Ù‡</div>
    </a>
    <a class="nav-item" href="#" onclick="showPage('transactions')">
        <div class="nav-icon">ğŸ“‹</div>
        <div class="nav-label">ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§</div>
    </a>
    <a class="nav-item" href="#" onclick="showPage('add')">
        <div class="nav-icon">â•</div>
        <div class="nav-label">Ø§ÙØ²ÙˆØ¯Ù†</div>
    </a>
    <a class="nav-item" href="#" onclick="showPage('exchange')">
        <div class="nav-icon">ğŸ’±</div>
        <div class="nav-label">ØªØ¨Ø¯ÛŒÙ„ Ø§Ø±Ø²</div>
    </a>
    <a class="nav-item" href="#" onclick="showPage('reports')">
        <div class="nav-icon">ğŸ“Š</div>
        <div class="nav-label">Ú¯Ø²Ø§Ø±Ø´â€ŒÙ‡Ø§</div>
    </a>
</div>

<!-- Modals -->
<div class="modal" id="detailModal">
    <div class="modal-content">
        <div class="modal-header">
            <div class="modal-title">
                <span id="modalIcon">ğŸ“</span>
                <span id="modalTitleText">Ø¬Ø²Ø¦ÛŒØ§Øª ØªØ±Ø§Ú©Ù†Ø´</span>
            </div>
            <button class="modal-close" onclick="closeModal('detailModal')">âœ•</button>
        </div>
        <div id="modalBody"></div>
    </div>
</div>

<input type="file" id="importFileInput" accept=".json" style="display: none;" onchange="handleFileImport(event)">

<script>
// Database Structure
let db = {
    transactions: [],
    balances: {
        AFN: 0,
        TRY: 0,
        USD: 0,
        AED: 0
    },
    selectedCountry: 'AFG',
    settings: {
        currency: 'USD',
        language: 'fa'
    }
};

// Exchange Rates (Ù†Ø±Ø®â€ŒÙ‡Ø§ÛŒ ÙˆØ§Ù‚Ø¹ÛŒ - Ø¨Ø§ÛŒØ¯ Ø¨Ù‡â€ŒØ±ÙˆØ² Ø´ÙˆÙ†Ø¯)
const exchangeRates = {
    USD: { AFN: 70, TRY: 32, AED: 3.67, USD: 1 },
    AFN: { USD: 1/70, TRY: 32/70, AED: 3.67/70, AFN: 1 },
    TRY: { USD: 1/32, AFN: 70/32, AED: 3.67/32, TRY: 1 },
    AED: { USD: 1/3.67, AFN: 70/3.67, TRY: 32/3.67, AED: 1 }
};

// Initialize App
document.addEventListener('DOMContentLoaded', function() {
    loadData();
    updateDashboard();
    updateExchangeRates();
    
    // Auto-save every 30 seconds
    setInterval(saveData, 30000);
});

// Load data from localStorage
function loadData() {
    const saved = localStorage.getItem('khademiFamilyAccounting');
    if (saved) {
        try {
            const parsed = JSON.parse(saved);
            db = { ...db, ...parsed };
        } catch (e) {
            console.error('Error loading data:', e);
        }
    }
}

// Save data to localStorage
function saveData() {
    try {
        localStorage.setItem('khademiFamilyAccounting', JSON.stringify(db));
    } catch (e) {
        console.error('Error saving data:', e);
        showToast('Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ!', 'error');
    }
}

// Show page
function showPage(page) {
    event.preventDefault();
    
    // Remove active class
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
    
    // Add active class
    document.getElementById(page + 'Page').classList.add('active');
    
    // Find and activate corresponding nav item
    const navItems = document.querySelectorAll('.nav-item');
    navItems.forEach((item, index) => {
        if ((page === 'dashboard' && index === 0) ||
            (page === 'transactions' && index === 1) ||
            (page === 'add' && index === 2) ||
            (page === 'exchange' && index === 3) ||
            (page === 'reports' && index === 4)) {
            item.classList.add('active');
        }
    });
    
    // Update content
    if (page === 'dashboard') {
        updateDashboard();
    } else if (page === 'transactions') {
        displayAllTransactions();
    } else if (page === 'reports') {
        updateReports();
    } else if (page === 'settings') {
        // Settings page
    }
    
    // Scroll to top
    window.scrollTo(0, 0);
}

// Show settings
function showSettings() {
    showPage('settings');
}

// Select country
function selectCountry(country) {
    db.selectedCountry = country;
    document.querySelectorAll('.country-btn').forEach(btn => {
        btn.classList.remove('active');
        if (btn.dataset.country === country) {
            btn.classList.add('active');
        }
    });
}

// Handle type change
function handleTypeChange() {
    const type = document.getElementById('transactionType').value;
    const transferGroup = document.getElementById('transferCurrencyGroup');
    transferGroup.style.display = type === 'transfer' ? 'block' : 'none';
}

// Add transaction
function addTransaction(event) {
    event.preventDefault();
    
    const type = document.getElementById('transactionType').value;
    const currency = document.getElementById('currency').value;
    const amount = parseFloat(document.getElementById('amount').value);
    const description = document.getElementById('description').value;
    const notes = document.getElementById('notes').value;
    
    if (!amount || amount <= 0) {
        showToast('Ù„Ø·ÙØ§Ù‹ Ù…Ø¨Ù„Øº Ù…Ø¹ØªØ¨Ø± ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯!', 'error');
        return;
    }
    
    const transaction = {
        id: Date.now(),
        type: type,
        currency: currency,
        amount: amount,
        description: description,
        notes: notes,
        country: db.selectedCountry,
        date: new Date().toISOString(),
        timestamp: Date.now()
    };
    
    // Update balance
    if (type === 'income') {
        db.balances[currency] += amount;
    } else if (type === 'expense') {
        if (db.balances[currency] < amount) {
            showToast('Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ú©Ø§ÙÛŒ Ù†ÛŒØ³Øª!', 'error');
            return;
        }
        db.balances[currency] -= amount;
    } else if (type === 'transfer') {
        const toCurrency = document.getElementById('toCurrency').value;
        if (currency === toCurrency) {
            showToast('Ø§Ø±Ø² Ù…Ø¨Ø¯Ø§ Ùˆ Ù…Ù‚ØµØ¯ Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ù†Ø¯ ÛŒÚ©Ø³Ø§Ù† Ø¨Ø§Ø´Ù†Ø¯!', 'error');
            return;
        }
        if (db.balances[currency] < amount) {
            showToast('Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ú©Ø§ÙÛŒ Ù†ÛŒØ³Øª!', 'error');
            return;
        }
        db.balances[currency] -= amount;
        const convertedAmount = amount * exchangeRates[currency][toCurrency];
        db.balances[toCurrency] += convertedAmount;
        transaction.toCurrency = toCurrency;
        transaction.convertedAmount = convertedAmount;
        transaction.rate = exchangeRates[currency][toCurrency];
    }
    
    db.transactions.push(transaction);
    saveData();
    
    // Reset form
    document.getElementById('transactionForm').reset();
    document.getElementById('transferCurrencyGroup').style.display = 'none';
    
    showToast('âœ… ØªØ±Ø§Ú©Ù†Ø´ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø«Ø¨Øª Ø´Ø¯', 'success');
    
    // Go to dashboard
    setTimeout(() => {
        showPage('dashboard');
    }, 1500);
}

// Update dashboard
function updateDashboard() {
    // Update currency cards
    document.getElementById('balanceAFN').textContent = formatNumber(db.balances.AFN);
    document.getElementById('balanceTRY').textContent = formatNumber(db.balances.TRY);
    document.getElementById('balanceUSD').textContent = formatNumber(db.balances.USD);
    document.getElementById('balanceAED').textContent = formatNumber(db.balances.AED);
    
    // Calculate stats
    let totalIncome = 0;
    let totalExpense = 0;
    let totalTransfers = 0;
    
    db.transactions.forEach(t => {
        if (t.type === 'income') totalIncome += t.amount;
        else if (t.type === 'expense') totalExpense += t.amount;
        else if (t.type === 'transfer') totalTransfers += t.amount;
    });
    
    const netBalance = totalIncome - totalExpense;
    
    document.getElementById('totalIncome').textContent = formatNumber(totalIncome);
    document.getElementById('totalExpense').textContent = formatNumber(totalExpense);
    document.getElementById('totalTransfers').textContent = formatNumber(totalTransfers);
    document.getElementById('netBalance').textContent = formatNumber(netBalance);
    document.getElementById('transactionCount').textContent = db.transactions.length + ' ØªØ±Ø§Ú©Ù†Ø´';
    
    // Display recent transactions
    displayRecentTransactions();
}

// Display recent transactions
function displayRecentTransactions() {
    const container = document.getElementById('recentTransactions');
    const recent = db.transactions.slice(-6).reverse();
    
    if (recent.length === 0) {
        container.innerHTML = `
            <div class="empty-state">
                <div class="empty-icon">ğŸ“­</div>
                <div class="empty-text">Ù‡Ù†ÙˆØ² ØªØ±Ø§Ú©Ù†Ø´ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª</div>
            </div>
        `;
        return;
    }
    
    container.innerHTML = recent.map(t => createTransactionHTML(t)).join('');
}

// Display all transactions
function displayAllTransactions() {
    const container = document.getElementById('allTransactions');
    const sorted = [...db.transactions].reverse();
    
    if (sorted.length === 0) {
        container.innerHTML = `
            <div class="empty-state">
                <div class="empty-icon">ğŸ“‹</div>
                <div class="empty-text">ØªØ±Ø§Ú©Ù†Ø´ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯</div>
            </div>
        `;
        return;
    }
    
    container.innerHTML = sorted.map(t => createTransactionHTML(t, true)).join('');
}

// Create transaction HTML
function createTransactionHTML(t, showDelete = false) {
    const icons = { income: 'ğŸ’°', expense: 'ğŸ’¸', transfer: 'ğŸ”„' };
    const icon = icons[t.type] || 'ğŸ“';
    const sign = t.type === 'income' ? '+' : t.type === 'expense' ? '-' : '';
    
    return `
        <div class="transaction-item" data-type="${t.type}" data-currency="${t.currency}" onclick="showTransactionDetail(${t.id})">
            <div class="transaction-icon ${t.type}">${icon}</div>
            <div class="transaction-info">
                <div class="transaction-title">${t.description}</div>
                <div class="transaction-desc">
                    <span>${formatDate(t.date)}</span>
                    <span>â€¢</span>
                    <span>${getCurrencyName(t.currency)}</span>
                    ${t.country ? `<span>â€¢</span><span>${getCountryName(t.country)}</span>` : ''}
                </div>
            </div>
            <div class="transaction-amount ${t.type}">
                ${sign}${formatNumber(t.amount)}
            </div>
            ${showDelete ? `<button class="delete-btn" onclick="deleteTransaction(${t.id}, event)">ğŸ—‘ï¸</button>` : ''}
        </div>
    `;
}

// Show transaction detail
function showTransactionDetail(id) {
    const t = db.transactions.find(tr => tr.id === id);
    if (!t) return;
    
    const icons = { income: 'ğŸ’°', expense: 'ğŸ’¸', transfer: 'ğŸ”„' };
    const icon = icons[t.type] || 'ğŸ“';
    const typeNames = { income: 'Ø¯Ø±Ø¢Ù…Ø¯', expense: 'Ù‡Ø²ÛŒÙ†Ù‡', transfer: 'Ø§Ù†ØªÙ‚Ø§Ù„ ÙˆØ¬Ù‡' };
    
    document.getElementById('modalIcon').textContent = icon;
    document.getElementById('modalTitleText').textContent = 'Ø¬Ø²Ø¦ÛŒØ§Øª ØªØ±Ø§Ú©Ù†Ø´';
    
    let html = `
        <div style="margin-bottom: 20px;">
            <div style="font-size: 14px; color: var(--gray); margin-bottom: 8px; font-weight: 600;">Ù†ÙˆØ¹ ØªØ±Ø§Ú©Ù†Ø´</div>
            <div style="font-size: 16px; font-weight: 700;">${typeNames[t.type]}</div>
        </div>
        <div style="margin-bottom: 20px;">
            <div style="font-size: 14px; color: var(--gray); margin-bottom: 8px; font-weight: 600;">Ù…Ø¨Ù„Øº</div>
            <div style="font-size: 24px; font-weight: 800; color: var(--primary);">${formatNumber(t.amount)} ${t.currency}</div>
        </div>
    `;
    
    if (t.type === 'transfer' && t.toCurrency) {
        html += `
            <div style="margin-bottom: 20px;">
                <div style="font-size: 14px; color: var(--gray); margin-bottom: 8px; font-weight: 600;">ØªØ¨Ø¯ÛŒÙ„ Ø¨Ù‡</div>
                <div style="font-size: 20px; font-weight: 700;">${formatNumber(t.convertedAmount)} ${t.toCurrency}</div>
                <div style="font-size: 12px; color: var(--gray); margin-top: 4px;">Ù†Ø±Ø®: ${t.rate ? t.rate.toFixed(4) : '-'}</div>
            </div>
        `;
    }
    
    html += `
        <div style="margin-bottom: 20px;">
            <div style="font-size: 14px; color: var(--gray); margin-bottom: 8px; font-weight: 600;">Ø´Ø±Ø­</div>
            <div style="font-size: 16px;">${t.description}</div>
        </div>
    `;
    
    if (t.notes) {
        html += `
            <div style="margin-bottom: 20px;">
                <div style="font-size: 14px; color: var(--gray); margin-bottom: 8px; font-weight: 600;">ÛŒØ§Ø¯Ø¯Ø§Ø´Øª</div>
                <div style="font-size: 14px; line-height: 1.6; background: var(--light); padding: 12px; border-radius: 8px;">${t.notes}</div>
            </div>
        `;
    }
    
    html += `
        <div style="margin-bottom: 20px;">
            <div style="font-size: 14px; color: var(--gray); margin-bottom: 8px; font-weight: 600;">ØªØ§Ø±ÛŒØ®</div>
            <div style="font-size: 14px;">${formatDate(t.date, true)}</div>
        </div>
        <div style="margin-bottom: 20px;">
            <div style="font-size: 14px; color: var(--gray); margin-bottom: 8px; font-weight: 600;">Ú©Ø´ÙˆØ±</div>
            <div style="font-size: 14px;">${getCountryName(t.country)}</div>
        </div>
        <button class="btn btn-danger btn-block" onclick="deleteTransaction(${t.id})">
            ğŸ—‘ï¸ Ø­Ø°Ù ØªØ±Ø§Ú©Ù†Ø´
        </button>
    `;
    
    document.getElementById('modalBody').innerHTML = html;
    document.getElementById('detailModal').classList.add('active');
}

// Delete transaction
function deleteTransaction(id, event = null) {
    if (event) {
        event.stopPropagation();
    }
    
    if (!confirm('Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ø§ÛŒÙ† ØªØ±Ø§Ú©Ù†Ø´ Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø¯Ø§Ø±ÛŒØ¯ØŸ')) return;
    
    const t = db.transactions.find(tr => tr.id === id);
    if (!t) return;
    
    // Reverse the transaction
    if (t.type === 'income') {
        db.balances[t.currency] -= t.amount;
    } else if (t.type === 'expense') {
        db.balances[t.currency] += t.amount;
    } else if (t.type === 'transfer') {
        db.balances[t.currency] += t.amount;
        if (t.toCurrency) {
            db.balances[t.toCurrency] -= t.convertedAmount || 0;
        }
    }
    
    // Remove transaction
    db.transactions = db.transactions.filter(tr => tr.id !== id);
    saveData();
    
    showToast('âœ… ØªØ±Ø§Ú©Ù†Ø´ Ø­Ø°Ù Ø´Ø¯', 'success');
    
    closeModal('detailModal');
    updateDashboard();
    displayAllTransactions();
}

// Filter transactions
function filterTransactions(filter) {
    // Update active tab
    document.querySelectorAll('.filter-tab').forEach(tab => tab.classList.remove('active'));
    event.currentTarget.classList.add('active');
    
    // Filter items
    const items = document.querySelectorAll('#allTransactions .transaction-item');
    items.forEach(item => {
        const type = item.dataset.type;
        const currency = item.dataset.currency;
        
        if (filter === 'all') {
            item.style.display = 'flex';
        } else if (['income', 'expense', 'transfer'].includes(filter)) {
            item.style.display = type === filter ? 'flex' : 'none';
        } else if (['AFN', 'TRY', 'USD', 'AED'].includes(filter)) {
            item.style.display = currency === filter ? 'flex' : 'none';
        }
    });
}

// Search transactions
function searchTransactions() {
    const query = document.getElementById('searchInput').value.toLowerCase();
    const items = document.querySelectorAll('#allTransactions .transaction-item');
    
    items.forEach(item => {
        const text = item.textContent.toLowerCase();
        item.style.display = text.includes(query) ? 'flex' : 'none';
    });
}

// Calculate exchange
function calculateExchange() {
    const from = document.getElementById('fromCurrency').value;
    const to = document.getElementById('toCurrencyExchange').value;
    const amount = parseFloat(document.getElementById('fromAmount').value);
    
    if (!amount || amount <= 0) {
        document.getElementById('toAmount').value = '';
        document.getElementById('exchangeRate').textContent = 'Ù†Ø±Ø®: -';
        return;
    }
    
    if (from === to) {
        document.getElementById('toAmount').value = amount.toFixed(2);
        document.getElementById('exchangeRate').textContent = 'Ù†Ø±Ø®: 1.0000';
        return;
    }
    
    const rate = exchangeRates[from][to];
    const result = amount * rate;
    
    document.getElementById('toAmount').value = result.toFixed(2);
    document.getElementById('exchangeRate').textContent = `Ù†Ø±Ø®: ${rate.toFixed(4)}`;
}

// Execute exchange
function executeExchange() {
    const from = document.getElementById('fromCurrency').value;
    const to = document.getElementById('toCurrencyExchange').value;
    const amount = parseFloat(document.getElementById('fromAmount').value);
    
    if (!amount || amount <= 0) {
        showToast('Ù„Ø·ÙØ§Ù‹ Ù…Ø¨Ù„Øº Ù…Ø¹ØªØ¨Ø± ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯!', 'error');
        return;
    }
    
    if (from === to) {
        showToast('Ø§Ø±Ø² Ù…Ø¨Ø¯Ø§ Ùˆ Ù…Ù‚ØµØ¯ Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ù†Ø¯ ÛŒÚ©Ø³Ø§Ù† Ø¨Ø§Ø´Ù†Ø¯!', 'error');
        return;
    }
    
    if (db.balances[from] < amount) {
        showToast('Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ú©Ø§ÙÛŒ Ù†ÛŒØ³Øª!', 'error');
        return;
    }
    
    const rate = exchangeRates[from][to];
    const result = amount * rate;
    
    // Update balances
    db.balances[from] -= amount;
    db.balances[to] += result;
    
    // Add transaction
    const transaction = {
        id: Date.now(),
        type: 'transfer',
        currency: from,
        amount: amount,
        toCurrency: to,
        convertedAmount: result,
        rate: rate,
        description: `ØªØ¨Ø¯ÛŒÙ„ ${getCurrencyName(from)} Ø¨Ù‡ ${getCurrencyName(to)}`,
        notes: `Ù†Ø±Ø® ØªØ¨Ø¯ÛŒÙ„: ${rate.toFixed(4)}`,
        country: db.selectedCountry,
        date: new Date().toISOString(),
        timestamp: Date.now()
    };
    
    db.transactions.push(transaction);
    saveData();
    
    showToast('âœ… ØªØ¨Ø¯ÛŒÙ„ Ø§Ø±Ø² Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯', 'success');
    
    // Reset form
    document.getElementById('fromAmount').value = '';
    document.getElementById('toAmount').value = '';
    
    updateDashboard();
}

// Update exchange rates display
function updateExchangeRates() {
    document.getElementById('rateUSD_AFN').textContent = exchangeRates.USD.AFN.toFixed(2);
    document.getElementById('rateUSD_TRY').textContent = exchangeRates.USD.TRY.toFixed(2);
    document.getElementById('rateUSD_AED').textContent = exchangeRates.USD.AED.toFixed(2);
}

// Update reports
function updateReports() {
    // Currency balances
    document.getElementById('reportAFN').textContent = formatNumber(db.balances.AFN);
    document.getElementById('reportTRY').textContent = formatNumber(db.balances.TRY);
    document.getElementById('reportUSD').textContent = formatNumber(db.balances.USD);
    document.getElementById('reportAED').textContent = formatNumber(db.balances.AED);
    
    // Calculate totals
    let totalIncome = 0;
    let totalExpense = 0;
    let totalTransfers = 0;
    
    db.transactions.forEach(t => {
        if (t.type === 'income') totalIncome += t.amount;
        else if (t.type === 'expense') totalExpense += t.amount;
        else if (t.type === 'transfer') totalTransfers += t.amount;
    });
    
    const netBalance = totalIncome - totalExpense;
    
    document.getElementById('reportTotalIncome').textContent = formatNumber(totalIncome);
    document.getElementById('reportTotalExpense').textContent = formatNumber(totalExpense);
    document.getElementById('reportTotalTransfers').textContent = formatNumber(totalTransfers);
    document.getElementById('reportNetBalance').textContent = formatNumber(netBalance);
    
    // Country balances (example calculation)
    const totalUSD = db.balances.USD + 
                     (db.balances.AFN / exchangeRates.USD.AFN) + 
                     (db.balances.TRY / exchangeRates.USD.TRY) + 
                     (db.balances.AED / exchangeRates.USD.AED);
    
    document.getElementById('reportAfghanistan').textContent = formatNumber(db.balances.AFN) + ' AFN';
    document.getElementById('reportTurkey').textContent = formatNumber(db.balances.TRY) + ' TRY';
    document.getElementById('reportDubai').textContent = formatNumber(db.balances.AED) + ' AED';
    document.getElementById('reportTotal').textContent = formatNumber(totalUSD) + ' USD';
}

// Show currency details
function showCurrencyDetails(currency) {
    const transactions = db.transactions.filter(t => 
        t.currency === currency || t.toCurrency === currency
    );
    
    alert(`${getCurrencyName(currency)}\n\nÙ…ÙˆØ¬ÙˆØ¯ÛŒ: ${formatNumber(db.balances[currency])}\nØªØ¹Ø¯Ø§Ø¯ ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§: ${transactions.length}`);
}

// Export data
function exportToJSON() {
    const dataStr = JSON.stringify(db, null, 2);
    const blob = new Blob([dataStr], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `khademi-accounting-${new Date().toISOString().split('T')[0]}.json`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    
    showToast('âœ… ÙØ§ÛŒÙ„ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø´Ø¯', 'success');
}

// Import data
function importFromJSON() {
    document.getElementById('importFileInput').click();
}

function handleFileImport(event) {
    const file = event.target.files[0];
    if (!file) return;
    
    const reader = new FileReader();
    reader.onload = function(e) {
        try {
            const imported = JSON.parse(e.target.result);
            
            if (confirm('Ø¢ÛŒØ§ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ÙØ¹Ù„ÛŒ Ø±Ø§ Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Ú©Ù†ÛŒØ¯ØŸ')) {
                db = imported;
                saveData();
                updateDashboard();
                showToast('âœ… Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª ÙˆØ§Ø±Ø¯ Ø´Ø¯Ù†Ø¯', 'success');
            }
        } catch (err) {
            showToast('âŒ ÙØ§ÛŒÙ„ Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª!', 'error');
        }
    };
    reader.readAsText(file);
    
    // Reset input
    event.target.value = '';
}

// Reset all data
function resetAllData() {
    if (!confirm('âš ï¸ Ù‡Ø´Ø¯Ø§Ø±!\n\nØ¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù ØªÙ…Ø§Ù… Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø¯Ø§Ø±ÛŒØ¯ØŸ\nØ§ÛŒÙ† Ø¹Ù…Ù„ÛŒØ§Øª Ù‚Ø§Ø¨Ù„ Ø¨Ø§Ø²Ú¯Ø´Øª Ù†ÛŒØ³Øª!')) return;
    
    if (prompt('Ø¨Ø±Ø§ÛŒ ØªØ§ÛŒÛŒØ¯ Ù†Ù‡Ø§ÛŒÛŒØŒ Ú©Ù„Ù…Ù‡ "Ø­Ø°Ù" Ø±Ø§ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯:') !== 'Ø­Ø°Ù') {
        showToast('Ø¹Ù…Ù„ÛŒØ§Øª Ù„ØºÙˆ Ø´Ø¯', 'error');
        return;
    }
    
    db = {
        transactions: [],
        balances: { AFN: 0, TRY: 0, USD: 0, AED: 0 },
        selectedCountry: 'AFG',
        settings: { currency: 'USD', language: 'fa' }
    };
    
    saveData();
    updateDashboard();
    displayAllTransactions();
    
    showToast('âœ… ØªÙ…Ø§Ù… Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø­Ø°Ù Ø´Ø¯Ù†Ø¯', 'success');
}

// Show about
function showAbout() {
    alert('Ø­Ø³Ø§Ø¨Ø¯Ø§Ø±ÛŒ Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ Ø®Ø§Ø¯Ù…ÛŒ\n\nÙ†Ø³Ø®Ù‡ 2.0\n\nØ¨Ø±Ù†Ø§Ù…Ù‡ Ø­Ø³Ø§Ø¨Ø¯Ø§Ø±ÛŒ Ú†Ù†Ø¯ Ø§Ø±Ø²ÛŒ Ø¨Ø±Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ø§Ù„ÛŒ Ø®Ø§Ù†ÙˆØ§Ø¯Ù‡\n\nØ§Ø±Ø²Ù‡Ø§: Ø§ÙØºØ§Ù†ÛŒØŒ Ù„ÛŒØ±Ù‡ØŒ Ø¯Ø§Ù„Ø±ØŒ Ø¯Ø±Ù‡Ù…\nÚ©Ø´ÙˆØ±Ù‡Ø§: Ø§ÙØºØ§Ù†Ø³ØªØ§Ù†ØŒ ØªØ±Ú©ÛŒÙ‡ØŒ Ø¯Ø¨ÛŒ\n\nÂ© 2025');
}

// Show help
function showHelp() {
    const help = `Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡:

ğŸ  Ø®Ø§Ù†Ù‡: Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ùˆ Ø¢Ù…Ø§Ø±
ğŸ“‹ ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§: Ù„ÛŒØ³Øª Ú©Ø§Ù…Ù„ ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§
â• Ø§ÙØ²ÙˆØ¯Ù†: Ø«Ø¨Øª ØªØ±Ø§Ú©Ù†Ø´ Ø¬Ø¯ÛŒØ¯
ğŸ’± ØªØ¨Ø¯ÛŒÙ„ Ø§Ø±Ø²: Ù…Ø­Ø§Ø³Ø¨Ù‡ Ùˆ ØªØ¨Ø¯ÛŒÙ„ Ø§Ø±Ø²
ğŸ“Š Ú¯Ø²Ø§Ø±Ø´â€ŒÙ‡Ø§: Ú¯Ø²Ø§Ø±Ø´â€ŒÙ‡Ø§ÛŒ Ù…Ø§Ù„ÛŒ

Ø¨Ø±Ø§ÛŒ Ø­Ø°Ù ØªØ±Ø§Ú©Ù†Ø´ØŒ Ø±ÙˆÛŒ Ø¢Ù† Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯.
Ø¨Ø±Ø§ÛŒ Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒØŒ Ø§Ø² Ø¨Ø®Ø´ Ú¯Ø²Ø§Ø±Ø´â€ŒÙ‡Ø§ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯.`;
    
    alert(help);
}

// Show backup
function showBackup() {
    if (confirm('Ø¢ÛŒØ§ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø§Ø² Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø®ÙˆØ¯ Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ø¨Ú¯ÛŒØ±ÛŒØ¯ØŸ')) {
        exportToJSON();
    }
}

// Close modal
function closeModal(modalId) {
    document.getElementById(modalId).classList.remove('active');
}

// Close modal on backdrop click
document.addEventListener('click', function(e) {
    if (e.target.classList.contains('modal')) {
        e.target.classList.remove('active');
    }
});

// Helper functions
function formatNumber(num) {
    return new Intl.NumberFormat('fa-IR', {
        maximumFractionDigits: 2,
        minimumFractionDigits: 0
    }).format(num);
}

function formatDate(dateString, detailed = false) {
    const date = new Date(dateString);
    const options = detailed ? 
        { year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' } :
        { year: 'numeric', month: 'short', day: 'numeric' };
    return new Intl.DateTimeFormat('fa-IR', options).format(date);
}

function getCurrencyName(code) {
    const names = {
        'AFN': 'Ø§ÙØºØ§Ù†ÛŒ',
        'TRY': 'Ù„ÛŒØ±Ù‡',
        'USD': 'Ø¯Ø§Ù„Ø±',
        'AED': 'Ø¯Ø±Ù‡Ù…'
    };
    return names[code] || code;
}

function getCountryName(code) {
    const names = {
        'AFG': 'ğŸ‡¦ğŸ‡« Ø§ÙØºØ§Ù†Ø³ØªØ§Ù†',
        'TUR': 'ğŸ‡¹ğŸ‡· ØªØ±Ú©ÛŒÙ‡',
        'UAE': 'ğŸ‡¦ğŸ‡ª Ø¯Ø¨ÛŒ'
    };
    return names[code] || code;
}

function showToast(message, type = 'success') {
    const toast = document.createElement('div');
    toast.className = `toast ${type}`;
    toast.textContent = message;
    document.body.appendChild(toast);
    
    setTimeout(() => {
        toast.style.opacity = '0';
        setTimeout(() => toast.remove(), 300);
    }, 3000);
}

// Handle back button on mobile
window.addEventListener('popstate', function() {
    const activePage = document.querySelector('.page.active');
    if (activePage && activePage.id !== 'dashboardPage') {
        showPage('dashboard');
    }
});

// Prevent context menu on long press (mobile)
document.addEventListener('contextmenu', function(e) {
    if (e.target.closest('.nav-item') || e.target.closest('.btn')) {
        e.preventDefault();
    }
});
</script>

</body>
</html>